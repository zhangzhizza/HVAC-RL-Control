# eplus-env
### Updates
**2017-04-25**: An evaluation environment has been added, Eplus-eval-v0. The environment has the same
action input and environment output structure as the Eplus-v0. However, the building model is changed
a little to ensure it is different from the building model used for training. The evaluation environment's 
building model has the following changes compared to the Eplus-v0 env:

* stochastic occupancy schedule generated by the LBNL occupancy simulator (http://occupancysimulator.lbl.gov/);
* stochastic equipment schedule generated based on the stochastic occupancy schedule, that is min(occup + N~(0, 0.2), 0.1);
* heating and cooling equipment sizing is increased by 20%;
* AHU supply air temperature setpoint control strategy is changed to outdoor air reset (18 or 12, based on OA 0 or 32);
* location of the building is changed to State College, PA, so is the weather file. 

**2017-04-30**: An new evaluation environment has been added, Eplus-eval-multiagent-v0. The environment uses the same model
as the Eplus-eval-v0, i.e. stochastic occupancy/equipment, different weather file, etc. However, this environment outputs 
the observations for all 4 perimeter zones, and takes the heating/cooling setpoint of the all 4 perimeter zones as the inputs. 
Thus, the output order is [weather info (6 in total), zone 1 observations (8 in total), ... , zone 4 observations (8 in total), HVAC total energy consumption
 (1 in total)]. The input order is [heating and cooling setpoint for zone 1 (2 in total), ... , heating and cooling setpoint for zone 4 (2 in total)].  

 **2017-05-09**: Four new environment has been added, Eplus-v1, Eplus-eval-v1, Eplus-v2, Eplus-eval-v2. They are the same as the Eplus-v0 and Eplus-eval-v0, except
 the simulation time step is 5 min. Also, for v2 environments, running period is one whole year. Also, the clothing value and mean radiant temperature are deleted from the state observation. In addition, the zone outdoor air control is changed to remove the hard limits on zone minimum outdoor air flow rate.  

**2017-06-26**: v3 environments are added. v3 environments are modified based on the v1 environments, with the following changes: occupancy status is no longer
a state observation; no holidays are observed for the *-eval environment; baseline and default HVAC operation periods are 7:00 to 18:00. 


###
This environment wraps the EnergyPlus-v-8-6 into the OpenAI gym environment interface. 
### Installation
EnergyPlus is platform dependent. So this repository does not include the EnergyPlus. Please download
the EnergyPlus-v-8-6 from https://energyplus.net/downloads, extract it, and place it to the directory 
eplus_env/envs/EnergyPlus-8-6-0. 

The environment depends on BCVTB-1.6.0 (https://simulationresearch.lbl.gov/bcvtb). There 
is no need to re-install it since this repository already had it. But BCVTB-1.6.0 is compiled
with Java-1.8. Make sure you have Java-1.8 on your OS. 

```sh
$ cd eplus-env
$ pip install -e .
```
### Usage
#### Overview
The environment wraps a one-story 5-zone office EnergyPlus model. It is assumed the building is located in
Pittsburgh, PA, USA. The HAVC system is centralized VAV with terminal reheat. The building has one air handling
unit serving all five zones, and the primary heating/cooling source is DX-coil. Simulation time step is 900 seconds
, and running period for one episode is Jan 1st 00:00:00 to Mar 31st 24:00:00. For more info about the 
building model, please refer to the top part of eplus_env/envs/5ZoneAutoDXVAV.idf file. 
#### Action input and environment output
There are two environments, Eplus-v0 and Eplus-forecast-v0. Both environments take a 1-D python list of float with
length 2 as action input, representing the heating setpoint and cooling setpoint (in order) in degree Celsius of 
the south zone. The ouput from reset or step function is different for the two environments. Eplus-v0 outputs a 
1-D python tuple of [curSimTime, sensorOut, isTerminal] and Eplus-forecast-v0 outputs a 1-D python tuple of
[curSimTime, sensorOut, weatherForecast, isTerminal]. 

* curSimTime: current simulation time counting in seconds from Jan 1st 00:00:00.

* sensorOut: 1-D python list of float [**0** Site Outdoor Air Drybulb Temperature (C), 
                                       **1** Site Outdoor Air Relative Humidity (%), 
                                       **2** Site Wind Speed (m/s), 
                                       **3** Site Wind Direction (degree from north), 
                                       **4** Site Diffuse Solar Radiation Rate per Area (W/m2), 
                                       **5** Site Direct Solar Radiation Rate per Area (W/m2), 
                                       **6** Zone Thermostat Heating Setpoint Temperature (C), 
                                       **7** Zone Thermostat Cooling Setpoint Temperature (C),
                                       **8** Zone Air Temperature (C), 
                                       **9** Zone Thermal Comfort Mean Radiant Temperature (C), 
                                       **10** Zone Air Relative Humidity (%),  
                                       **11** Zone Thermal Comfort Clothing Value (clo), 
                                       **12** Zone Thermal Comfort Fanger Model PPD, 
                                       **13** Zone People Occupant Count, 
                                       **14** Facility Total HVAC Electric Demand Power (W)]. 
**Note**: Zone People Occupant Count is here just for an indication whether the zone is occupied or not (1 or 0). 

* weatherForecast: 2-D python list with shape (36, 28) where row x is the weather forecast information for 
the x time steps ahead of the curSimTime, where columns are the weather variables and the order is 
0 Dry Bulb Temperature {C},1 Dew Point Temperature
{C},2 Relative Humidity {%},3 Atmospheric Pressure {Pa},4 Extraterrestrial Horizontal Radiation
{Wh/m2},5 Extraterrestrial Direct Normal Radiation {Wh/m2},6 Horizontal Infrared
Radiation Intensity from Sky {Wh/m2},7 Global Horizontal Radiation {Wh/m2},8 Direct
Normal Radiation {Wh/m2},9 Diffuse Horizontal Radiation {Wh/m2},10 Global Horizontal
Illuminance {lux},11 Direct Normal Illuminance {lux},12 Diffuse Horizontal Illuminance
{lux},13 Zenith Luminance {Cd/m2},14 Wind Direction {deg},15 Wind Speed {m/s},16 Total Sky
Cover {.1}, 17 Opaque Sky Cover {.1},18 Visibility {km},Ceiling Height {m},Present Weather
Observation,Present Weather Codes,Precipitable Water {mm},Aerosol Optical Depth
{.001},Snow Depth {cm},Days Since Last Snow,Albedo {.01},Liquid Precipitation Depth
{mm},Liquid Precipitation Quantity {hr}.

* isTerminal: whether the current episode finishs or not. When the simulation time reaches the end of the 
EnergyPlus run period (Mar 31st 24:00:00), the episode ends. 

#### Running output

EnergyPlus logs its own output. The output will be stored under the directory $pwd/Eplus-env-runX/Eplus-env-sub_runX/output. The "sub_run" directory is the directory for each episode that the environment runs.

#### Public attributes
* min_max_limits: The minimum and maximum possible values for all state features. Return a python list of tuples. The tuples are in the same
order as the sensorOut order. The index 0 of the tuple is the minimum value and the index 1 is the maximum value. It returns:
min_max_limits = [(-16.7, 26.0),
                  (  0.0, 100.0),
                  (  0.0, 23.1),
                  (  0.0, 360.0),
                  (  0.0, 389.0),
                  (  0.0, 905.0),
                  ( 15.0, 30.0),
                  ( 15.0, 30.0),
                  ( 15.0, 30.0),
                  ( 15.0, 30.0),
                  (  0.0, 100.0),
                  (  0.5, 1.0),
                  (  0.0, 1.0),
                  (  0.0, 1.0),
                  (  0.0, 33000.0)];

* start_year: EnergyPlus simulation start year, int.
* start_mon: EnergyPlus simulation start month, int.
* start_day: EnergyPlus simulation start day of the month, int.
* start_weekday: EnergyPlus simulation start weekday, int. 0 is Monday. 


### Example

```python
import gym;
import eplus_env;

env = gym.make('Eplus-v0');
min_max_limits = env.min_max_limits; # Access public attribute
curSimTime, ob, isTerminal = env.reset(); # Reset the env (creat the EnergyPlus subprocess)
while not isTerminal:
    action = someFuncToGetAction(curSimTime, ob); # Should return a python list of float with len 2
    curSimTime, ob, isTerminal = env.step(action);
curSimTime, ob, isTerminal = env.reset(); # Reset the env (creat the EnergyPlus subprocess)
while not isTerminal:
    action = someFuncToGetAction(curSimTime, ob); # Should return a python list of float with len 2
    curSimTime, ob, isTerminal = env.step(action);
                  
env.end_env(); # Safe end the environment after use. 
```
